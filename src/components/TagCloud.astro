---
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const tagCounts = allPosts.reduce((acc, post) => {
	post.data.tags?.forEach((tag) => {
		acc[tag] = (acc[tag] || 0) + 1;
	});
	return acc;
}, {} as Record<string, number>);

const tags = Object.entries(tagCounts)
	.sort(([, a], [, b]) => b - a)
	.slice(0, 20);
---

{
	tags.length > 0 && (
		<div class="tag-cloud">
			<h3>태그</h3>
			<div class="tags">
				{tags.map(([tag, count]) => (
					<a href={`/blog/tag/${tag}`} class="tag">
						#{tag} <span class="count">({count})</span>
					</a>
				))}
			</div>
		</div>
	)
}

<style>
	.tag-cloud {
		margin-bottom: 1.5rem;
	}
	.tag-cloud h3 {
		font-size: 0.95rem;
		margin-bottom: 0.75rem;
		color: rgb(var(--gray-dark));
	}
	.tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.4rem;
	}
	.tag {
		display: inline-block;
		padding: 0.2rem 0.6rem;
		background-color: rgb(var(--gray-light));
		color: rgb(var(--gray-dark));
		border-radius: 0.3rem;
		font-size: 0.8rem;
		text-decoration: none;
		transition: background-color 0.2s ease, color 0.2s ease;
	}
	.tag:hover {
		background-color: rgb(var(--accent));
		color: white;
	}
	.count {
		font-size: 0.7rem;
		opacity: 0.7;
	}
</style>
