---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const allPosts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// 카테고리별로 그룹화
const postsByCategory = allPosts.reduce((acc, post) => {
	const parts = post.id.split('/');
	const category = parts.length > 1 ? parts[0] : '기타';
	if (!acc[category]) {
		acc[category] = [];
	}
	acc[category].push(post);
	return acc;
}, {} as Record<string, typeof allPosts>);

// 카테고리 이름 한글화
const categoryNames: Record<string, string> = {
	'spring': 'Spring',
	'react': 'React',
	'기타': '기타'
};
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<div class="blog-container">
		{Object.entries(postsByCategory).map(([category, posts]) => (
			<section class="category-section">
				<h2 class="category-title">{categoryNames[category] || category}</h2>
				<ul>
					{posts.map((post) => (
						<li>
							<a href={`/blog/${post.id}/`}>
								{post.data.heroImage && (
									<Image width={400} height={200} src={post.data.heroImage} alt="" />
								)}
								<h4 class="title">{post.data.title}</h4>
								<p class="date">
									<FormattedDate date={post.data.pubDate} />
								</p>
							</a>
						</li>
					))}
				</ul>
			</section>
		))}
	</div>
</BaseLayout>

<style>
	.blog-container {
		width: 960px;
		max-width: calc(100% - 2em);
		margin: 0 auto;
		padding: 2em 1em;
	}

	.category-section {
		margin-bottom: 4rem;
	}

	.category-title {
		font-size: 2rem;
		margin-bottom: 1.5rem;
		padding-bottom: 0.5rem;
		border-bottom: 3px solid rgb(var(--accent));
		color: rgb(var(--black));
	}

	ul {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 1.5rem;
		list-style-type: none;
		margin: 0;
		padding: 0;
	}

	ul li * {
		text-decoration: none;
		transition: 0.2s ease;
	}

	ul li img {
		width: 100%;
		height: auto;
		margin-bottom: 0.75rem;
		border-radius: 8px;
		object-fit: cover;
	}

	ul li a {
		display: block;
	}

	.title {
		margin: 0 0 0.5rem 0;
		color: rgb(var(--black));
		line-height: 1.3;
		font-size: 1.25rem;
	}

	.date {
		margin: 0;
		color: rgb(var(--gray));
		font-size: 0.9rem;
	}

	ul li a:hover h4,
	ul li a:hover .date {
		color: rgb(var(--accent));
	}

	ul li a:hover img {
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
		transform: translateY(-2px);
	}

	@media (max-width: 960px) {
		ul {
			grid-template-columns: repeat(2, 1fr);
			gap: 1rem;
		}
	}

	@media (max-width: 720px) {
		.blog-container {
			width: 100%;
			padding: 1.5em 1em;
		}

		.category-section {
			margin-bottom: 3rem;
		}

		.category-title {
			font-size: 1.5rem;
		}

		ul {
			grid-template-columns: 1fr;
			gap: 1.5rem;
		}

		.title {
			font-size: 1.1rem;
		}
	}
</style>
