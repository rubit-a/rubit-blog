---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import FormattedDate from '../../../components/FormattedDate.astro';

export async function getStaticPaths() {
	const allPosts = await getCollection('blog');
	const uniqueTags = [...new Set(allPosts.flatMap((post) => post.data.tags || []))];

	return uniqueTags.map((tag) => {
		const filteredPosts = allPosts
			.filter((post) => post.data.tags?.includes(tag))
			.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
		return {
			params: { tag },
			props: { posts: filteredPosts },
		};
	});
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout
	title={`태그: ${tag} | Rubit Blog`}
	description={`${tag} 태그가 포함된 블로그 포스트`}
>
	<section>
		<h1>#{tag}</h1>
		<p>{posts.length}개의 포스트</p>
		<ul class="post-list">
			{
				posts.map((post) => (
					<li>
						<a href={`/blog/${post.id}/`}>
							{post.data.heroImage && (
								<Image width={720} height={360} src={post.data.heroImage} alt="" />
							)}
							<h4 class="title">{post.data.title}</h4>
							<p class="date">
								<FormattedDate date={post.data.pubDate} />
							</p>
							<p class="description">{post.data.description}</p>
						</a>
					</li>
				))
			}
		</ul>
	</section>
</BaseLayout>

<style>
	section {
		width: 960px;
		max-width: calc(100% - 2em);
		margin: 0 auto;
		padding: 2em 1em;
	}
	h1 {
		font-size: 2.5rem;
		margin-bottom: 0.5rem;
		color: rgb(var(--accent));
	}
	.post-list {
		display: grid;
		gap: 2rem;
		list-style-type: none;
		margin: 2rem 0;
		padding: 0;
	}
	.post-list li {
		width: 100%;
	}
	.post-list li a {
		display: block;
		text-decoration: none;
		transition: 0.2s ease;
	}
	.post-list li a:hover {
		transform: translateY(-4px);
	}
	.post-list img {
		margin-bottom: 0.5rem;
		border-radius: 12px;
		width: 100%;
	}
	.post-list a:hover img {
		box-shadow: var(--box-shadow);
	}
	.title {
		margin: 0.5rem 0;
		color: rgb(var(--black));
		line-height: 1.3;
	}
	.date {
		margin: 0.25rem 0;
		color: rgb(var(--gray));
		font-size: 0.9rem;
	}
	.description {
		margin: 0.5rem 0;
		color: rgb(var(--gray-dark));
		line-height: 1.5;
	}
	@media (max-width: 720px) {
		section {
			width: 100%;
		}
	}
</style>
